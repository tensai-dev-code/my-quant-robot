name: Quant Bot Operations

on:
  # 1. ì›”~ê¸ˆ í•œêµ­ì‹œê°„ ì˜¤í›„ 6ì‹œ ìë™ ì‹¤í–‰ ì„¤ì •
  schedule:
    - cron: '0 9 * * 1-5' 

  # 2. ìˆ˜ë™ ì‹¤í–‰ ì˜µì…˜ ì„¤ì •
  workflow_dispatch:
    inputs:
      job:
        description: 'ì‹¤í–‰í•  ì‘ì—…ì„ ì„ íƒí•˜ì„¸ìš”'
        required: true
        default: 'daily_full_process'
        type: choice
        options:
          - daily_full_process  # ì „ì²´ ìë™ ê³µì • (ìˆ˜ì§‘+ì¶”ì¶œ+ëˆ„ì +ì¶”ì²œ)
          - all_stocks          # ì „ì²´ì¢…ëª© ë¦¬ìŠ¤íŠ¸ë§Œ ê°±ì‹ 
          - quant_target        # í€€íŠ¸ëŒ€ìƒ 250ê°œ ì¶”ì¶œ
          - yearly_data         # 1ë…„ì¹˜ ìƒì„¸ë°ì´í„° ì´ˆê¸°í™” ìˆ˜ì§‘
          - daily_recommend     # ì˜¤ëŠ˜ ì¢…ëª© ì¶”ì²œë§Œ ì‹¤í–‰

jobs:
  execute:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
      - name: Install dependencies
        run: pip install finance-datareader gspread oauth2client pandas
      - name: Run Script
        env:
          GCP_SERVICE_ACCOUNT: ${{ secrets.GOOGLE_SERVICE_ACCOUNT_JSON }}
          SPREADSHEET_ID: ${{ secrets.SPREADSHEET_ID }}
        # ìˆ˜ë™ ì‹¤í–‰ ì‹œì—ëŠ” job ì„ íƒê°’ì„ ì‚¬ìš©í•˜ê³ , ìë™ ìŠ¤ì¼€ì¤„ëŸ¬(schedule) ì‹¤í–‰ ì‹œì—ëŠ” daily_full_processë¥¼ ê¸°ë³¸ê°’ìœ¼ë¡œ ì‚¬ìš©í•¨
        run: python run_bot.py ${{ github.event.inputs.job || 'daily_full_process' }}
        # [ìˆ˜ì •ëœ ë©”ì¼ ë°œì†¡ ë‹¨ê³„]
      - name: Send Mail
        if: success()
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp.gmail.com
          server_port: 465
          username: ${{ secrets.EMAIL_USER }}
          password: ${{ secrets.EMAIL_PASSWORD }}
          subject: "ğŸš€ ì˜¤ëŠ˜ì˜ í€€íŠ¸ ì¶”ì²œ ì¢…ëª© ë¦¬ìŠ¤íŠ¸"
          to: "leedch@gabiacns.com"
          from: "Quant Bot <${{ secrets.EMAIL_USER }}>"
          # íŒŒì¼(email_body.html) ë‚´ìš©ì„ ë³¸ë¬¸ìœ¼ë¡œ ì‚¬ìš©
          html_body: file://email_body.html
        
